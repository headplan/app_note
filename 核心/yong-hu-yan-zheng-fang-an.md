# 用户验证方案

**使用HTTPS协议**

避免信息泄露 , 最基本的方案是所有涉及安全性的API请求都必须使用HTTPS协议 .

HTTPS实际上应用了安全套接字层SSL作为HTTP应用层的子层 .

HTTPS的模型

* HTTP
* SSL/TLS
* TCP
* IP
* 网络传输

**基本的用户登录方案**

传统Web网站使用Cookie+Session保持用户的登录状态 .

App的解决方案 :

* 输入了这把锁上的注册的用户名和密码
* 用房间管理员提供的钥匙

用户进入的流程

1. 用户第一次输入锁上注册的用户名和密码打开锁头进入房间 , 找管理员提供一把钥匙
   1. 用户登录的操作
2. 以后用户每次需要进入的时候用钥匙即可
   1. 用户登录后身份验证的操作
3. 用户决定一段时间不进入房间 , 然后进入房间吧钥匙还给管理员 , 管理员销毁钥匙
   1. 用户退出登录的操作

计算机的操作

1. App后台接收到App发送的用户名和密码 , 验证用户名密码是否正确 , 错误返回错误信息 , 正确生成一个随机的不重复的token字符串 , token字符串作为用户的唯一标识 . 在Redis中建立token字符串和用户信息的对应关系 .
2. App后台把token字符串和用户信息返回给App , App保存这些数据作为以后身份验证的必备数据 . 
3. 需要验证用户身份的操作必须要把token字符串传给App后台验证身份 .  
   当App后台接收到这个api请求时 , 权限设置中要求验证用户身份 , 于是取出参数中的token值 , 在第一步中建立的token字符串和用户信息的对应关系中查找 , 如果没发现这个token值 , 则返回验证失败的信息 , 如果发现这个token值 , 则获取这个用户的信息 , 进行相关的操作 .

4. 当用户退出登录时 , 通过调用退出登录的API , 让App后台把这个用户对应的token字符串删除 .  
   退出登录的API也要验证用户身份 , 调用时需要加上token , 当接收到退出的请求 , 先验证token是否存在 , 存在就删除 .

生成token流程图

![](/assets/token.png)

为了防止token泄露 , 下面的内容会提供防止token在通信中泄露的方案 . 

